# DC-DC 转换器技术资料自动收集系统

## 📋 项目概述

本系统是一个自动化的技术文档收集工具，专门用于收集 DC-DC 转换器相关的技术资料（如 datasheet、application note 等），通过 AI 关键词生成 + 智能搜索 + 自动下载的方式，持续构建技术知识库。

## ✨ 核心功能

### 1. AI 智能关键词生成
- **使用 Google Gemini** 自动生成高质量的搜索关键词
- 基于已下载文档和使用历史自动优化关键词策略
- 关键词自动包含 `filetype:pdf` 以精准定位技术文档
- 支持多轮迭代，避免重复搜索

### 2. 智能搜索与下载
- **使用真实 Chrome 浏览器** 进行搜索，绕过反爬虫限制
- 自动从 DuckDuckGo 搜索结果中下载 PDF 文件
- 智能厂商识别，自动分类存储（TI、Analog、ST、Infineon 等）
- 支持断点续传，避免重复下载

### 3. 关键词管理系统
- 记录每个关键词的使用次数和下载成功率
- 智能过滤低效关键词
- 追踪关键词表现，优化搜索策略
- 防止重复使用相同关键词

### 4. 增强的反检测机制
- **隐藏自动化标识**，浏览器显示为正常用户访问
- 移除 "Chrome 正在受到自动化测试软件的控制" 提示
- 模拟真实用户行为，包括鼠标移动、随机延迟等
- 支持保持登录状态，无需每次重新登录

### 5. 持续运行与状态管理
- 支持 **24/7 持续运行**，自动生成新关键词并搜索下载
- 自动保存进度，支持断点续传
- **Ctrl+C 优雅退出**，不会丢失数据
- 可配置下载限制（文件数量、总大小、运行轮数）

## 🏗️ 系统架构

```
integrated_searcher.py          # 主控制器
    ├── GeminiKeywordGenerator  # Gemini AI 关键词生成
    │   ├── 自动化 Chrome 控制
    │   ├── 关键词生成与提取
    │   └── 反检测机制
    ├── KeywordManager          # 关键词数据库管理
    │   ├── 关键词记录
    │   ├── 使用统计
    │   └── 智能过滤
    └── DdgFetcherBrowser       # 浏览器搜索下载
        ├── DuckDuckGo 搜索
        ├── PDF 识别与下载
        └── 厂商分类存储
```

## 📊 工作流程

```
1. 启动系统
   ↓
2. 初始化 Chrome + 登录 Gemini
   ↓
3. [循环] 生成新关键词
   ├── 读取历史数据
   ├── 构建上下文 Prompt
   ├── Gemini 生成关键词
   └── 提取并验证关键词
   ↓
4. [循环] 搜索下载
   ├── 使用关键词搜索 DuckDuckGo
   ├── 提取 PDF 链接
   ├── 下载文件
   ├── 识别厂商并分类
   └── 记录统计信息
   ↓
5. 更新状态 → 等待 → 返回步骤 3
```

## 🚀 使用方法

### 基础运行
```bash
python integrated_searcher.py
```

### 快速启动（Windows）
```bash
.\start_continuous.bat
```

### 高级选项
```bash
python integrated_searcher.py --help

选项：
  -o, --output PATH        输出目录 (默认: downloads_continuous)
  -k, --keywords PATH      关键词数据库路径 (默认: keywords.json)
  -c, --config PATH        配置文件路径 (默认: continuous_search_config.json)
  --debug                  启用调试模式
```

## ⚙️ 配置说明

配置文件：`continuous_search_config.json`

```json
{
  "gemini_headless": false,           // Gemini 是否使用无头模式
  "keywords_per_round": 10,           // 每轮生成关键词数量
  "results_per_keyword": 20,          // 每个关键词搜索结果数
  "max_rounds": 0,                    // 最大轮数 (0=无限制)
  "round_interval": 300,              // 轮次间隔(秒)
  "total_files_limit": 10000,         // 文件总数限制
  "total_size_limit_gb": 100,         // 总大小限制(GB)
  "focus_areas": [                    // 重点关注领域
    "DC-DC converter",
    "buck converter",
    "boost converter",
    "automotive power"
  ]
}
```

## 📁 输出结构

```
downloads_continuous/
├── results.jsonl              # 下载记录 (JSONL 格式)
├── summary.csv                # 统计摘要
├── search_state.json          # 运行状态
├── _temp_downloads/           # 临时下载目录
├── ti/                        # Texas Instruments
├── analog/                    # Analog Devices
├── st/                        # STMicroelectronics
├── infineon/                  # Infineon
├── onsemi/                    # ON Semiconductor
├── microchip/                 # Microchip
├── nxp/                       # NXP
├── renesas/                   # Renesas
├── mps/                       # Monolithic Power Systems
└── unknown/                   # 未识别厂商
```

## 🔧 核心技术特性

### 1. 多方案驱动启动
系统采用三重备份策略确保 Chrome 能正常启动：
- **方案1**: Selenium 内置驱动管理（无需网络）
- **方案2**: ChromeDriverManager 自动下载（需要网络）
- **方案3**: 本地 chromedriver.exe（手动部署）

### 2. 增强反自动化检测
```python
# 隐藏 webdriver 属性
Object.defineProperty(navigator, 'webdriver', {
    get: () => undefined
});

# 添加真实浏览器特征
- Chrome runtime 对象
- 插件信息模拟
- 权限查询覆盖
- 真实 User-Agent
```

### 3. 智能关键词提取
支持多种 Gemini 响应格式：
- 编号列表：`1. keyword`
- 符号列表：`- keyword` 或 `* keyword`
- 引号格式：`"keyword"`
- 反引号格式：`` `keyword` ``
- 纯文本按行分割

### 4. 厂商智能识别
基于文件名和 URL 的模式匹配：
```python
vendor_patterns = {
    'ti': ['ti.com', 'texas instruments', 'TI-'],
    'analog': ['analog.com', 'analog devices', 'AD-'],
    'st': ['st.com', 'stmicroelectronics', 'STM'],
    # ... 更多厂商
}
```

## 📈 统计与监控

### 关键词统计
- 每个关键词的使用次数
- 下载成功的文件数
- 成功率排序
- Top 10 最有效关键词

### 下载统计
- 总文件数
- 总下载大小
- 按厂商分类统计
- 搜索轮数和时间

### 实时日志
```
2026-01-26 16:33:13 [INFO] 🎯 第 6 轮: 生成关键词
2026-01-26 16:33:14 [INFO] ✅ 已点击发送按钮
2026-01-26 16:33:20 [INFO] 📋 提取到 10 个关键词
2026-01-26 16:33:21 [INFO] 🔍 搜索: LM2596 buck converter datasheet...
2026-01-26 16:33:25 [INFO] ✅ 下载成功: LM2596_datasheet.pdf (TI)
```

## 🛡️ 错误处理与恢复

### 自动重试机制
- Chrome 启动失败 → 尝试清理缓存并重试
- 搜索超时 → 自动切换到下一个关键词
- 下载失败 → 记录并继续（不中断流程）

### 优雅退出
```bash
按 Ctrl+C 安全退出
→ 保存当前状态
→ 关闭浏览器
→ 清理临时文件
→ 更新统计数据
```

### 断点续传
- 自动加载上次运行状态
- 继续使用之前的轮次编号
- 避免重复下载已存在的文件

## 🐛 故障排除

### Chrome 启动失败
```bash
# 运行修复工具
python fix_chromedriver.py

# 清理缓存
python clean_chatgpt_cache.py
```

### Gemini 未登录
- 首次运行会自动打开浏览器
- 手动登录 Google Gemini
- 登录状态会自动保持

### 关键词提取失败
- 检查 Gemini 响应格式
- 运行测试脚本：`python test_gemini_response.py`
- 查看 DEBUG 日志了解详情

## 📝 开发与维护

### 调试模式
```bash
python integrated_searcher.py --debug
```
输出详细的：
- 浏览器交互日志
- 关键词提取过程
- 网络请求详情
- 文件处理步骤

### 测试工具
- `test_gemini_response.py` - 测试 Gemini 响应和关键词提取
- `fix_chromedriver.py` - 修复 ChromeDriver 问题
- `clean_chatgpt_cache.py` - 清理缓存

### 代码结构
```
chatgpt_keyword_generator.py   # 672 行 - AI 关键词生成
integrated_searcher.py          # 596 行 - 主控制逻辑
keyword_manager.py              # ~300 行 - 关键词管理
ddg_fetcher_browser.py          # ~500 行 - 搜索下载
```

## 🎯 使用场景

1. **技术资料收集** - 自动收集 DC-DC 相关的所有技术文档
2. **知识库构建** - 为团队建立完整的参考资料库
3. **竞品分析** - 收集不同厂商的产品文档对比
4. **学习研究** - 自动下载学习所需的技术资料
5. **持续更新** - 24/7 运行，持续获取最新技术文档

## ⚡ 性能优化

- **并行下载**: 多个文件同时下载（可配置）
- **智能过滤**: 避免下载已存在或重复的文件
- **增量搜索**: 基于历史优化搜索策略
- **缓存机制**: 关键词和搜索结果本地缓存

## 🔒 隐私与安全

- 使用本地 Chrome 浏览器，不上传任何数据
- 登录凭证保存在本地浏览器配置中
- 所有下载文件保存在本地目录
- 不涉及任何云端服务或第三方数据传输

## 📄 许可与声明

- 本工具仅供学习和研究使用
- 请遵守目标网站的使用条款和 robots.txt
- 下载的文档版权归原作者和厂商所有
- 建议合理控制下载速度，避免对服务器造成压力

## 🔄 更新日志

### v2.0.0 (2026-01-26)
- ✅ 增强反自动化检测，移除 Chrome 提示条
- ✅ 优化关键词提取算法，支持更多格式
- ✅ 添加 Ctrl+C 优雅退出功能
- ✅ 修复 ChromeDriver 缓存损坏问题
- ✅ 改进错误处理和自动恢复机制

### v1.1.0 (2026-01-25)
- 集成 Gemini AI 关键词生成
- 添加智能厂商识别
- 实现持续运行模式

### v1.0.0 (初始版本)
- 基础搜索下载功能
- 关键词管理系统

## 💡 最佳实践

1. **首次运行**: 不使用 headless 模式，手动登录 Gemini
2. **后续运行**: 可以启用 headless 模式提高效率
3. **定期维护**: 每隔一段时间清理重复文件和整理分类
4. **监控日志**: 观察关键词效果，手动调整 focus_areas
5. **资源限制**: 根据磁盘空间设置合理的大小限制

---

**开发者**: AI 助手  
**版本**: 2.0.0  
**Python**: 3.10+  
**最后更新**: 2026-01-26
